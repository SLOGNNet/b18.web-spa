<div class="sticked-items-section">
  <form-navigation sticky [title]="'Load'" [anchors]="anchors" class="sticked-form-navigation"></form-navigation>
  <template #customItemTemplate let-model="item" let-index="index">
      <div class="dropdown-customer-item-wrapper">
        <div class="full-properties-wrapper">
          <div class="name-title">
            {{model.name}}
          </div>
          <div class="properties">
            MC#: {{model.mc}}
          </div>
        </div>
      </div>
  </template>
  <form [formGroup]="loadForm" class="edit">
    <navigation-anchor id="load"></navigation-anchor>
    <bd-form-section labelText="Load">
      <bd-input class="bd-form-control" [labelText]="'Load Number'" formControlName="loadNumber">
      </bd-input>
      <bd-form-switch class="bd-form-control" [labelText]="'Load Type'" [enableButtonSwitch]="isEditMode" formControlName="loadType" [items]="loadTypesNames">
      </bd-form-switch>
      <bd-form-switch class="bd-form-control" [labelText]="'Freight'" [enableButtonSwitch]="isEditMode" formControlName="freightType" [items]="freightTypesNames">
      </bd-form-switch>
      <bd-dropdown class="bd-form-control" [labelText]="'Data Assignee'" formControlName="dataAssignee" [items]="dataAssigneeNames">
      </bd-dropdown>
    </bd-form-section>
    <navigation-anchor id="customer"></navigation-anchor>
    <bd-form-section labelText="Customer">
      <bd-validator [component]="loadForm.controls.customer" [errorDefs]="{required: 'Customer is required'}">
        <bd-typeahead
          class="bd-form-control"
          formControlName="customer"
          [labelText]="'Name or MC#'"
          [footerButtonText]="'Add New Customer'"
          [source]="customerSource"
          (onRemove)="onCustomerRemove()"
          [(value)]="customerQuery"
          [itemTemplate]="customItemTemplate"
          (onSelect)="onCustomerSelect($event)"
          (onFooterButtonClick)="onAddNewCustomer()"
          [optionField]="'name'">
        </bd-typeahead>
      </bd-validator>
        <customer-form *ngIf='load.customer' [submitButtonText]="'Add Customer'" [customer]='load.customer' (save)="onCustomerSave($event)" (cancel)="onCustomerEditCancel()" [viewMode]="customerViewMode"> </customer-form>
        <bd-form-section>
          <bd-dropdown
            *ngIf='load.customer'
            class="bd-form-control"
            labelText='Address'
            clearLabel='Leave Empty'
            formControlName="addressId"
            defaultTitleText="Select address"
            [dropdownItemTemplate]="addressDropdown"
            [items]="load.customer.addresses"
            keyField="id"
            valueField="name">
          </bd-dropdown>
        </bd-form-section>
        <bd-form-section>
          <bd-dropdown
            *ngIf='load.customer'
            clearLabel='Leave Empty'
            class="bd-form-control"
            labelText='Billing Address'
            formControlName="billingAddressId"
            defaultTitleText="Select Billing Address"
            [dropdownItemTemplate]="addressDropdown"
            [items]="load.customer.addresses"
            keyField="id"
            valueField="name">
          </bd-dropdown>
        </bd-form-section>
        <bd-form-section>
          <bd-dropdown
            *ngIf='load.customer'
            clearLabel='Leave Empty'
            class="bd-form-control"
            labelText='Contact'
            defaultTitleText="Select Contact"
            formControlName="contactId"
            [items]="load.customer.contacts"
            keyField="id"
            valueField="firstName">
          </bd-dropdown>
        </bd-form-section>
        <navigation-anchor id="pickups"></navigation-anchor>
        <bd-form-section labelText="PICKUPS">
          <pickups-form [formArray]="loadForm.controls.pickups" [items]="load.pickups" [viewMode]="viewMode" [type]="stopTypes.Pickup"></pickups-form>
        </bd-form-section>
        <navigation-anchor id="dropoffs"></navigation-anchor>
        <bd-form-section labelText="DROPOFFS">
          <dropoffs-form [formArray]="loadForm.controls.dropoffs" [items]="load.dropoffs" [viewMode]="viewMode" [type]="stopTypes.Dropoff"></dropoffs-form>
        </bd-form-section>
        <navigation-anchor id="requirements"></navigation-anchor>
        <bd-form-section labelText="REQUIREMENTS">
          <bd-form-switch class="bd-form-control" [labelText]="'Driver'" [enableButtonSwitch]="isEditMode" formControlName="driverRequirement" [items]="driverRequirementsNames">
          </bd-form-switch>
          <bd-dropdown class="bd-form-control" [labelText]="'Power unit'" formControlName="powerUnitType" [items]="powerUnitTypesNames">
          </bd-dropdown>
          <bd-dropdown class="bd-form-control" [labelText]="'Trailer'" formControlName="trailerType" [items]="trailerTypesNames">
          </bd-dropdown>
          <bd-textarea
            class="bd-form-control"
            formControlName="specialRequirment"
          [labelText]="'Special Requirements'">
          </bd-textarea>
        </bd-form-section>
      </bd-form-section>
      <div class="button-group" sticky [top]="false">
        <bd-button
          [text]="'Cancel'"
          class="bd-button button"
          (click)="onLoadCancel()">
        </bd-button>
        <bd-button
          color="primary"
          class="bd-button button"
          [text]="'Save'"
          (click)="onLoadSave()">
        </bd-button>
      </div>
  </form>
  <template #addressDropdown let-item="item">
    <address-item-template [item]='item'></address-item-template>
  </template>
</div>
